<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Digimon Trials Dex</title>

<style>
/* =====================
   THEME
===================== */
:root {
  --bg-main: #0f1115;
  --bg-panel: #171a21;
  --bg-card: #1f2430;
  --bg-subtle: #232838;
  --text-main: #f2f4f8;
  --text-dim: #a8b0c2;
  --border: rgba(255,255,255,0.08);
}

/* =====================
   BASE
===================== */
body {
  margin: 0;
  padding: 32px;
  background: var(--bg-main);
  color: var(--text-main);
  font-family: system-ui, sans-serif;
}

.app {
  max-width: 1400px;
  margin: auto;
}

h1, .subtitle { text-align: center; }
.subtitle { color: var(--text-dim); font-size: 0.95rem; }

/* =====================
   SEARCH
===================== */
.search-box {
  display: block;
  margin: 24px auto 0;
  width: 100%;
  max-width: 720px;
  padding: 14px 16px;
  font-size: 0.95rem;
  border-radius: 10px;
  border: 1px solid var(--border);
  background: var(--bg-panel);
  color: #fff;
}

/* =====================
   FILTERS
===================== */
.filters {
  margin-top: 14px;
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
  justify-content: center;
  align-items: flex-end;
}

.filter-group {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.filter-group label {
  font-size: 0.7rem;
  letter-spacing: 0.08em;
  color: var(--text-dim);
}

.filter-group select {
  background: var(--bg-panel);
  border: 1px solid var(--border);
  color: var(--text-main);
  padding: 8px 10px;
  border-radius: 8px;
}

#clearFilters {
  height: 36px;
  padding: 0 22px;
  border-radius: 999px;
  background: #0b0d12;
  color: #d0d4dc;
  border: 1px solid rgba(255,255,255,0.12);
  cursor: pointer;
}

/* =====================
   GRID
===================== */
#dex {
  margin-top: 28px;
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 18px;
}

/* =====================
   CARD
===================== */
.entry {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 16px;
  cursor: pointer;
  height: 230px;
  display: flex;
  flex-direction: column;
}

.entry-header {
  display: flex;
  justify-content: space-between;
}

.entry-title {
  font-size: 1.25rem;
  font-weight: 800;
}

.stage {
  font-size: 0.75rem;
  padding: 4px 10px;
  border-radius: 999px;
  background: var(--bg-subtle);
  color: var(--text-dim);
}

.types {
  display: flex;
  gap: 6px;
  flex-wrap: wrap;
  margin-top: 6px;
}

.type {
  padding: 4px 10px;
  font-size: 0.65rem;
  border-radius: 999px;
  border: 1.5px solid currentColor;
  font-weight: 600;
}

.normal{color:#cfd8dc}.fire{color:#ff8a65}.water{color:#64b5f6}
.ice{color:#4dd0e1}.electric{color:#ffee58}.grass{color:#81c784}
.bug{color:#aed581}.fighting{color:#ef5350}.flying{color:#90caf9}
.dark{color:#9575cd}.holy{color:#fff59d}.dragon{color:#7986cb}
.steel{color:#b0bec5}.poison{color:#ba68c8}.ground{color:#bc8f6a}
.fairy{color:#f48fb1}.magic{color:#ec407a}.undead{color:#7e57c2}
.mystery{color:#26c6da}.rock{color:#91543c}

.entry-desc {
  font-size: 0.8rem;
  color: var(--text-dim);
  margin-top: 6px;
  flex-grow: 1;
}

.evo-strip {
  font-size: 0.75rem;
  color: var(--text-dim);
  border-top: 1px solid var(--border);
  padding-top: 6px;
}

/* =====================
   MODAL
===================== */
.overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.75);
  display: flex;
  align-items: center;
  justify-content: center;
}

.hidden { display: none; }

.modal {
  width: min(720px, 92vw);
  background: var(--bg-panel);
  border-radius: 16px;
  padding: 24px;
}
/* =====================
   HEADER / NAV
===================== */
h1 {
  text-align: center;
}

.subtitle {
  text-align: center;
  margin-top: 6px;
  color: var(--text-dim);
  font-size: 0.95rem;
}

.nav {
  display: flex;
  justify-content: center;
  gap: 14px;
  margin: 24px 0;
}

.nav a {
  padding: 8px 18px;
  border-radius: 999px;
  border: 1px solid var(--border);
  text-decoration: none;
  color: var(--text-main);
  font-size: 0.8rem;
}

.nav a:hover {
  background: var(--bg-subtle);
}

/* =====================
   DROPDOWN NAV
===================== */
.dropdown {
  position: relative;
}

.dropdown-toggle {
  padding: 8px 18px;
  border-radius: 999px;
  border: 1px solid var(--border);
  background: none;
  color: var(--text-main);
  font-size: 0.8rem;
  cursor: pointer;
}

.dropdown-toggle:hover {
  background: var(--bg-subtle);
}

.dropdown-menu {
  position: absolute;
  top: 110%;
  left: 50%;
  transform: translateX(-50%);
  min-width: 180px;

  background: var(--bg-panel);
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 6px;

  display: none;
  flex-direction: column;
  z-index: 50;
}

.dropdown-menu a {
  padding: 10px 14px;
  border-radius: 10px;
  text-decoration: none;
  color: var(--text-main);
  font-size: 0.75rem;
}

.dropdown-menu a:hover {
  background: var(--bg-subtle);
}
</style>
</head>

<body>
<div class="app">

<h1>DIGIMON TRIALS DEX</h1>
<div class="subtitle">Fanmade Digimon ROM Hack</div>

<div class="nav">
  <a href="credits.html">CREDITS</a>
  <div class="dropdown">
    <button class="dropdown-toggle">GUIDE ▾</button>
    <div class="dropdown-menu">
      <a href="encounter.html">Encounters</a>
      <a href="faq.html">FAQ</a>
       <a href="tamers.html">TAMERS</a>
    </div>
  </div>
</div>

<input id="search" class="search-box" placeholder="Search Digimon...">

<div class="filters">
  <div class="filter-group">
    <label>Stage</label>
    <select id="stageFilter">
      <option value="">All</option>
      <option value="child">Child</option>
      <option value="adult">Adult</option>
      <option value="perfect">Perfect</option>
      <option value="mega">Mega</option>
      <option value="ultra">Ultra</option>
    </select>
  </div>

  <div class="filter-group">
    <label>Type</label>
    <select id="typeFilter">
      <option value="">All</option>
      <option value="fire">Fire</option>
      <option value="water">Water</option>
      <option value="grass">Grass</option>
      <option value="electric">Electric</option>
      <option value="dark">Dark</option>
      <option value="holy">Holy</option>
      <option value="ground">Ground</option>
      <option value="rock">Rock</option>
      <option value="fairy">Fairy</option>
      <option value="undead">Undead</option>
      <option value="steel">Steel</option>
      <option value="poison">Poison</option>
      <option value="bug">Bug</option>
      <option value="magic">Magic</option>
      <option value="ice">Ice</option>
      <option value="flying">Flying</option>
      <option value="dragon">Dragon</option>
      <option value="mystery">Mystery</option>
    </select>
  </div>

  <button id="clearFilters">Clear Filters</button>
</div>

<div id="dex"></div>
</div>

<div id="overlay" class="overlay hidden">
  <div class="modal">
    <h2 id="modal-title"></h2>
    <div id="modal-body"></div>
  </div>
</div>

<script>
let DATA = [];

fetch("digimon_data.json")
  .then(r => r.text())
  .then(t => {
    const clean = t.slice(0, t.lastIndexOf("}") + 1);
    return JSON.parse(clean);
  })
  .then(j => {
    DATA = j.digimon;
    render(DATA);
  });

const dex = document.getElementById("dex");
const search = document.getElementById("search");
const stageFilter = document.getElementById("stageFilter");
const typeFilter = document.getElementById("typeFilter");

function render(list) {
  dex.innerHTML = "";
  list.forEach(d => {
    const el = document.createElement("div");
    el.className = "entry";
    el.innerHTML = `
      <div class="entry-header">
        <div class="entry-title">${d.name}</div>
        <div class="stage">
  ${d.stage.charAt(0).toUpperCase() + d.stage.slice(1)}
</div>
      </div>
      <div class="types">
  ${(d.types || [])
    .filter(t => t && t !== "null" && t !== "none")
    .map(t => `
      <span class="type ${t}">
        ${t.charAt(0).toUpperCase() + t.slice(1)}
      </span>
    `)
    .join("")}
</div>

      <div class="entry-desc">${d.description || ""}</div>
      <div class="evo-strip">
  <strong>Digivolves To</strong>
  ${
    d.evolves_to && d.evolves_to.length
      ? `<ul>
          ${d.evolves_to.map(e =>
            `<li>${e.name}${e.condition ? ` — ${e.condition}` : ""}</li>`
          ).join("")}
        </ul>`
      : "—"
  }
</div>

    `;
    el.onclick = ()=>openModal(d);
    dex.appendChild(el);
  });
}

function openModal(d) {
  document.getElementById("modal-title").textContent = d.name;
  document.getElementById("modal-body").innerHTML = `
    <p>${d.description}</p>
    <ul>${(d.abilities||[]).map(a=>`<li>${a}</li>`).join("")}</ul>
  `;
  document.getElementById("overlay").classList.remove("hidden");
}

document.getElementById("overlay").onclick =
e=>e.target.id==="overlay"&&e.target.classList.add("hidden");

function applyFilters() {
  const q = search.value.toLowerCase().trim();

  render(DATA.filter(d => {
    // SEARCH BLOB (safe + extensible)
    const blob = [
      d.name,
      d.description,
      ...(d.abilities || []),
      ...(d.evolves_to || []).flatMap(e => [e.name, e.condition])
    ]
      .filter(Boolean)
      .join(" ")
      .toLowerCase();

    const matchesSearch = !q || blob.includes(q);
    const matchesStage  = !stageFilter.value || d.stage === stageFilter.value;
    const matchesType   =
      !typeFilter.value ||
      (Array.isArray(d.types) && d.types.includes(typeFilter.value));

    return matchesSearch && matchesStage && matchesType;
  }));
}

</script>
<script>
const dropdown = document.querySelector(".dropdown");
const toggle = dropdown.querySelector(".dropdown-toggle");
const menu = dropdown.querySelector(".dropdown-menu");

toggle.onclick = e => {
  e.stopPropagation();
  menu.style.display = menu.style.display === "flex" ? "none" : "flex";
};

document.onclick = ()=>menu.style.display="none";

search.addEventListener("input", applyFilters);
stageFilter.addEventListener("change", applyFilters);
typeFilter.addEventListener("change", applyFilters);

document.getElementById("clearFilters").onclick = () => {
  search.value = "";
  stageFilter.value = "";
  typeFilter.value = "";
  render(DATA);
};

</script>

</body>
</html>
